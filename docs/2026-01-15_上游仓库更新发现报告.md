# 📋 上游仓库更新发现报告 (2026-01-15)

## 0. 概述
本次调研针对 `su-kaka/gcli2api` 和 `lbjlaq/Antigravity-Manager` 两大上游仓库，汇总了自 2026-01-13 至 2026-01-15 期间的关键代码变更、Bug 修复及新功能。

---

## 1. 📦 `su-kaka/gcli2api` (核心后端)

### 核心变更汇总

| 日期 | Commit | 关键描述 | 影响范畴 |
|:--:|--|--|--|
| 01-14 | `160294d` | **优化重试速度** | ⚡ 提升失败请求的响应速度 |
| 01-14 | `abd4a3e` | **Revert "Update gemini_fix.py"** | 🔄 撤销了某次可能导致问题的 Gemini 格式修复 |
| 01-14 | `36d7cee` 等 | **持续迭代 `gemini_fix.py`** | 🔧 优化的 Gemini 格式校验和白名单过滤 |
| 01-13 | `fb33771` | **fix: use actual token counts in `message_start`** | 🐛 修复了 Anthropic SSE 事件中 token 计数的硬编码问题 |
| 01-13 | `0f3dc6e` | **py313** | 🐍 官方支持 Python 3.13 运行环境 |
| 01-13 | `963aa6c` | **解决 Termux 安装问题** | 📱 提升移动端 Termux 环境的部署稳定性 |

### 🔍 关键发现 (PR #276)
修复了长久以来的一个“障眼法”：在流式输出的 `message_start` 事件中，原本使用硬编码的 token 计数，现在改为使用 `token_estimator` 进行动态估算。这对客户端（如 Roo-Code）显示准确的费用/消耗至关重要。

---

## 2. 📦 `lbjlaq/Antigravity-Manager` (管理面板与工具链)

### 版本更新追踪

#### v3.3.31 (最新)
- **🐛 Claude Tool Call 修复**: 修复了 [#632](https://github.com/lbjlaq/Antigravity-Manager/issues/632) 中提到的 Claude 工具调用重复错误。
- **✨ API Key 编辑**: 支持在 API 代理页面直接编辑自定义 API Key。

#### v3.3.30
- **🛡️ 配额保护升级**: 实现了 **针对具体模型** 的配额保护 (Issue #621)。
- **🏗️ 迁移增强**: 配额保护数据的迁移逻辑更加健壮，使用精确原因匹配。

#### v3.3.29
- **🕵️ 参数幻觉修复**: 专门处理 Gemini 对 `grep`/`glob` 工具参数的严重幻觉问题（非常重要，建议同步）。
- **🎭 Playwright 增强**: 提升了 Playwright MCP 的稳定性和上下文优化。

#### v3.3.28 & v3.3.27
- **🧠 Thinking 模型支持**: 增强了对 `claude-*-thinking` 模型及其 `reasoning_content` 的收集。
- **🔥 配置热重载**: 实验性配置现在支持不重启应用直接生效。
- **📈 激进上下文缩放**: 引入了更具攻击性的上下文缩放算法。

#### v3.3.26
- **🖥️ 无头模式优化**: 通过 Xvfb 改进了在 Linux 无界面服务器上的部署体验。

---

## 3. 🎯 建议后续动作

### 🔴 立即同步 (Critical)
1. **Gemini 参数幻觉处理 (`32a7a64`)**: 解决 grep/glob 工具的错误调用。
2. **Claude 重复工具调用修复 (`c6ab5e6`)**: 避免逻辑冗余。
3. **SSE Token 计数修复 (`fb33771`)**: 提升客户端 UI 的准确性。

### 🟡 择机同步 (Recommended)
1. **模型级配额保护**: 更好管理各池子之间的流量。
2. **重试性能优化**: 减少网络等待。
3. **Thinking 收集优化**: 如果频繁使用 Claude Thinking 功能。

---
*报告生成：幽浮喵 (猫娘工程师) @ 2026-01-15*
